<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">
<title>Library</title>
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Custom Theme JavaScript -->
<script src="js/agency.js"></script>

<!-- jQuery -->
<script src="js/jquery.js"></script>
<script src="jquery.cookie.js"></script>
<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script
	src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="js/classie.js"></script>

<!-- Contact Form JavaScript -->
<script src="js/jqBootstrapValidation.js"></script>

<!-- Custom CSS -->
<link href="css/agency.css" rel="stylesheet">
<!-- Custom Fonts -->
<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet"
	type="text/css">
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
	rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Kaushan+Script'
	rel='stylesheet' type='text/css'>
<link
	href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic'
	rel='stylesheet' type='text/css'>
<link
	href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700'
	rel='stylesheet' type='text/css'>

</head>

<body id="page-top" class="index">
	<!-- Navigation -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="navbar-header page-scroll">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand page-scroll" href="#page-top">Start
					Library</a>
			</div>

			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li class="hidden"><a href="#page-top"></a></li>
					<li><a class="page-scroll" href="#login">Login</a></li>
					<li class="user"><a class="page-scroll" href="#myBooks">My
							books</a></li>
					<li><a class="page-scroll" href="#search">Search</a></li>
					<li class="librarian"><a class="page-scroll" href="#users">Users</a></li>
					<li id="exit"><a class="page-scroll" href="#users">Exit</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<section id="login" style="height: 980px">
		<div class="container">
			<div class="row">
				<h2 class="section-heading text-center">welcome to library</h2>
			</div>
			<div></div>
			<div class="row">
				<div class="col-lg-12 text-center">
					<h3 class="section-heading text-left">Login</h3>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<form name="sentData" id="userData" novalidate>
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
									<input type="text" class="form-control"
										placeholder="Your Email *" id="email" required
										data-validation-required-message="Please enter your email addres.">
									<p class="help-block text-danger"></p>
								</div>
								<div class="form-group">
									<input type="password" class="form-control"
										placeholder="Your Password *" id="password" required
										data-validation-required-message="Please enter your password.">
									<p class="help-block text-danger"></p>
								</div>
							</div>
							<div class="col-lg-12">
								<div id="success"></div>
								<button type="submit" id="sendBtn" class="btn btn-xl">Send</button>
								<a href="#registration" class="portfolio-link"
									data-toggle="modal">
									<button type="submit" id="btnreg" class="btn btn-xl">Registration</button>
								</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</section>
	<div class="portfolio-modal modal fade" id="registration" tabindex="-1"
		role="dialog" aria-hidden="true">
		<div class="modal-content">
			<div class="close-modal" data-dismiss="modal">
				<div class="lr">
					<div class="rl"></div>
				</div>
			</div>
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-lg-offset-2">
						<div class="modal-body">
                            <h2>registration form</h2>
                            <div>
                                <div class="col-lg-12 text-center" id="imgBlock">
                                    <div style="height: 150px; width: 150px; border: solid 1px #f0f0f0">
                                        <img id="imgLoad" src="#" alt="image" style="display: none; height: 150px; width: 150px;" />
                                    </div>
                                    <div style="margin-top: 10px; height: 50px; width: 70px;">
                                        <span class="btn btn-default btn-file">Browse
                                            <input type="file" id="flAvatar">
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group" style="margin:auto; width:500px">
									<input type="text" class="form-control"
										placeholder="Enter your first name *" id="txtFirstName" required
										data-validation-required-message="Please enter your first name.">
									<p class="help-block text-danger"></p>
								</div>
                                <div class="form-group" style="margin:auto; width:500px">
									<input type="text" class="form-control"
										placeholder="Enter your last name *" id="txtLastName" required
										data-validation-required-message="Please enter your last name.">
									<p class="help-block text-danger"></p>
								</div>
                                <div class="form-group" style="margin:auto; width:500px">
									<input type="email" class="form-control"
										placeholder="Enter your Email *" id="txtEmail" required
										data-validation-required-message="Please enter your email addres.">
									<p class="help-block text-danger"></p>
								</div>
                                <div style="margin:auto; width:500px" class="form-group">
									<input type="password" class="form-control"
										placeholder="Enter your Password *" id="txtPassword" required
										data-validation-required-message="Please enter your password.">
									<p class="help-block text-danger"></p>
                                </div>
                                 <div style="margin:auto; width:500px" class="form-group">
									<input type="password" class="form-control"
										placeholder="Enter your password again *" id="txtPasswordAgain" required
										data-validation-required-message="Please enter your password.">
									<p class="help-block text-danger"></p>
                                </div>
                                <div class="col-lg-12 text-right" >
                                    <button type="submit" id="btnSendData" class="btn btn-xl">Registration</button>                                    
                                </div>
                                <script>
                                   

                                </script>
                            </div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<section id="myBooks" class="user" style="height: 980px;">
		<div class="container">
			<div class="row">
				<div style="margin-top:40px;">
					<img class="imgAvatar" id="photoUsers"/>
				</div>
                <div id="nameUsers"></div>
			</div>
			<div class="row" style="width:900px; margin-top: 50px;">
				<div class="col-lg-12 text-left" style="height: 40px;">
					<h3 class="section-subheading text-muted" >Your Books</h3>
				</div>
                <div class="col-lg-12 text-center">
                    <div class="booksHead">
                        <div class="">Title</div>
                        <div>Author</div>
                        <div>Publishing House</div>
                        <div>Years</div>
                        <div>Page Number</div>
                    </div>
                    <div class="booksUser"></div>
                </div>
			</div>

		</div>
	</section>

	<!-- SEARCH -->
	<section id="search" class="bg-light-gray" style="height: 980px">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<h2 class="section-heading">Search</h2>
				</div>
			</div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="booksHead">
                        <div class="">Title</div>
                        <div>Author</div>
                        <div>Publishing House</div>
                        <div>Years</div>
                        <div>Page Number</div>
                    </div>
                    <div class="allBooks"></div>
                </div>
            </div>
		</div>
	</section>

	<!-- USERS -->
	<section id="users" class="librarian" style="height: 980px">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<h2 class="section-heading">USERS</h2>
				</div>
			</div>
		</div>
	</section>
	<footer>
		<div class="container">
			<div class="row">
				<div class="col-md-4">
					<span class="copyright">Nikolai Iakovlev &copy; My Library
						2015</span>
				</div>
				<div class="col-md-4">
					<ul class="list-inline social-buttons">
						<li><a href="#"><i class="fa fa-twitter"></i></a></li>
						<li><a href="#"><i class="fa fa-facebook"></i></a></li>
						<li><a href="#"><i class="fa fa-linkedin"></i></a></li>
					</ul>
				</div>
				<div class="col-md-4">
					<ul class="list-inline quicklinks">
						<li><a href="#"></a></li>
						<li><a href="#"></a></li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
	    var user;
	    $(document).ready(function () {
	        debugger;
	        getAllBooks();
	        if ($.cookie("userInfo") == "NaN")
	            $.cookie("userInfo", "null")
	        if ($.cookie("userInfo") == "null" || $.cookie("userInfo") == null) {
	            $('.nav li').hide()
	            $('#registr').show();
	            $('#login').show();
	        }
	        else if ($.cookie("userInfo") != "null") {
	            $('.nav li').show()
	            $('#registr').hide();
	            $('#login').hide();
	        }
	        if ($.cookie("userInfoid")) {
	            getbooksUser($.cookie("userInfoid"));
	            getUsers($.cookie("userInfoid"));
	        }
	    });
	    function getUsers(id) { 
	        var url = "http://localhost:8080/users/user/" + id + "/";
	        var request = $.get(url);
	        request.done(function (data) {
	            $("#photoUsers").attr("src", data.avatar);
	            $("#nameUsers").text(data.firstName + "  " + data.lastName);
	        });
	    }
	    function getAllBooks() {
	        var url = "http://localhost:8080/books/all";
	        var request = $.get(url);
	        request.done(function(dataBooks) {
	            $.each(dataBooks, function view(i) {
	                debugger;
	                $('.allBooks').append('<div class="books bookItemAll' + i + '"></div>');
	                $('.bookItemAll' + i).append('<div class="title Book">' + dataBooks[i].title + '</div>');
	                $('.bookItemAll' + i).append('<div class="author Book">' + dataBooks[i].author + '</div>');
	                $('.bookItemAll' + i).append('<div class="publishingHouse Book">' + dataBooks[i].publishingHouse + '</div>');
	                $('.bookItemAll' + i).append('<div class="years Book">' + dataBooks[i].years + '</div>');
	                $('.bookItemAll' + i).append('<div class="pageNumber Book">' + dataBooks[i].pageNumber + '</div>')
	            });
	        });
	    }

	    $('#btnSendData').click(function (e) {
	        debugger
	        var emaiReg = $("#txtEmail").val();
	        var passwordReg = $("#txtPassword").val();
	        var firstNameReg = $("#txtFirstName").val();
	        var lastNameReg = $("#txtLastName").val();
	        var passwordAgain = $("#txtPasswordAgain").val();
	        var imgAvatarReg = $('#imgLoad').attr('src');
	        var role = "user";

	        if (passwordReg != passwordAgain) {
	            return;
	        }
	        var JSONObjectUser = {
	            "id": 1,
	            "firstName": firstNameReg,
	            "lastName": lastNameReg,
	            "password": passwordReg,
	            "avatar": imgAvatarReg,
	            "email": emaiReg,
	            "role": role};
	        var request = $.ajax({
	        	  contentType: 'application/json',
	        	  url: "http://localhost:8080/user/add",
	        	  type: "POST",
	        	  data: JSON.stringify(JSONObjectUser),
	        	  dataType: "json"
	        });
	        request.done(userLogin(e, emaiReg, passwordReg))
	    });
	    function readURL(e) {
	        e.preventDefault();
	        if (this.files && this.files[0]) {
	            var reader = new FileReader();
	            $(reader).load(function (e) {
	                $('#imgLoad').attr('src', e.target.result);
	                $('#imgLoad').css("display", "inline");
	            });
	            reader.readAsDataURL(this.files[0]);
	        }
	    }
	    $("#flAvatar").change(readURL);
		
		$("#exit").click(function() {
			$.cookie("userInfo", "null");
			location.reload();
		});
		
		$("#sendBtn").click(
            function (e) {
                var emailUs = $("#email").val();
                var passwordUs = $("#password").val();
                userLogin(e, emailUs, passwordUs);
            });
		function userLogin(e, emailUss, passwordUss) {
		    debugger;
		    e.preventDefault();
		    var JSONObject = {
		        "password": passwordUss,
		        "email": emailUss,
		    }
		    var request = $.ajax({
		        contentType: 'application/json',
		        url: "http://localhost:8080/user/login/",
		        type: "POST",
		        data: JSON.stringify(JSONObject),
		        dataType: "json"
		    });
		    request.done(function (data) {
		        user = data;
		        $.cookie("userInfo", user.email + user.password, { expires: 7 });
		        $.cookie("userInfoid", user.id, { expires: 7 });
		        if ($.cookie("userInfo") != null) {
		            $('#regist').hide();
		            $('#login').hide();
		            $('#exit').show();
		            $('.nav li').show()
		        }
		        if (user != null) {
		            getbooksUser(data.id);
		            debugger;
		            if (user.role == "library") {
		                $(".user").hide();
		            }
		            if (user.role == "user") {
		                $(".librarian").hide();
		            }
		        }
		        location.reload();
		    });
		}
		function getbooksUser(id) {
		    var url = "http://localhost:8080/books/user/" + id + "/"
		    var posting = $.post(url, "json");
		    posting.done(function getBooksUser(dataBooks) {
		        var cList = $(' #booksUser');
		        $.each(dataBooks, function view(i) {
		            debugger;
		            $('.booksUser').append('<div class="books bookItem' + i + '"></div>');
		            $('.bookItem' + i).append('<div class="title Book">' + dataBooks[i].title + '</div>');
		            $('.bookItem' + i).append('<div class="author Book">' + dataBooks[i].author + '</div>');
		            $('.bookItem' + i).append('<div class="publishingHouse Book">' + dataBooks[i].publishingHouse + '</div>');
		            $('.bookItem' + i).append('<div class="years Book">' + dataBooks[i].years + '</div>');
		            $('.bookItem' + i).append('<div class="pageNumber Book">' + dataBooks[i].pageNumber + '</div>')
		        });
		    });
		}
    </script>
<style>
    .booksHead div {
        width: 155px;
        float: left;
        margin-left: 15px;
        text-align: left;
        border-bottom:#fed136 solid 1px;
    }
    .booksHead {
        margin-top:15px;
        font-size:15px;
    }
    .booksUser {
        padding-top:30px;
    }
    .allBooks {
        padding-top:30px;
    }
    .books {
        width:100%;
        float:left;
    }
    .Book {
        float: left;
        margin-left: 15px;
        text-align: left;
        width: 155px;
    }
    .pageNumber {
        width: 155px;
        margin-left: 15px;
        float: left;
    }
    #nameUsers {
        margin-top: 5px;
        font-size: 15px;
        color: #777;
    }
    .btn-file {
        position: relative;
        overflow: hidden;
    }
        .btn-file input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: inherit;
            display: block;
        }
    .imgAvatar {
        max-height:150px;
    }
    html, body {
        overflow-y: hidden;
    }

    li {
        list-style-type: none;
    }
    .navbar-default .nav li a {
        color:#777;
    }
    #login {
        background-color: #F0F0F0;
    }
</style>

</body>

</html>