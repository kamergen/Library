<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">
<title>Library</title>
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Custom Theme JavaScript -->
<script src="js/agency.js"></script>

<!-- jQuery -->
<script src="js/jquery.js"></script>
<script src="jquery.cookie.js"></script>
<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script
	src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="js/classie.js"></script>

<!-- Contact Form JavaScript -->
<script src="js/jqBootstrapValidation.js"></script>

<!-- Custom CSS -->
<link href="css/agency.css" rel="stylesheet">
<!-- Custom Fonts -->
<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet"
	type="text/css">
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
	rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Kaushan+Script'
	rel='stylesheet' type='text/css'>
<link
	href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic'
	rel='stylesheet' type='text/css'>
<link
	href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700'
	rel='stylesheet' type='text/css'>

</head>

<body id="page-top" class="index">
	<!-- Navigation -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="navbar-header page-scroll">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand page-scroll" href="#page-top">Start
					Library</a>
			</div>

			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li class="hidden"><a href="#page-top"></a></li>
					<li><a class="page-scroll" href="#login">Login</a></li>
					<li class="user"><a class="page-scroll" href="#myBooks">My
							books</a></li>
					<li><a class="page-scroll" href="#search">Search</a></li>
					<li class="librarian"><a class="page-scroll" href="#users">Users</a></li>
					<li id="exit"><a class="page-scroll" href="#users">Exit</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<section id="login" style="height: 980px">
		<div class="container">
			<div class="row">
				<h2 class="section-heading text-center">welcome to library</h2>
			</div>
			<div></div>
			<div class="row">
				<div class="col-lg-12 text-center">
					<h3 class="section-heading text-left">Login</h3>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<form name="sentData" id="userData" novalidate>
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
									<input type="text" class="form-control"
										placeholder="Your Email *" id="email" required
										data-validation-required-message="Please enter your email addres.">
									<p class="help-block text-danger"></p>
								</div>
								<div class="form-group">
									<input type="password" class="form-control"
										placeholder="Your Password *" id="password" required
										data-validation-required-message="Please enter your password.">
									<p class="help-block text-danger"></p>
								</div>
							</div>
							<div class="col-lg-12">
								<div id="success"></div>
								<button type="submit" id="sendBtn" class="btn btn-xl">Send</button>
								<a href="#registration" class="portfolio-link"
									data-toggle="modal">
									<button type="submit" id="btnreg" class="btn btn-xl">Registration</button>
								</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</section>
	<div class="portfolio-modal modal fade" id="registration" tabindex="-1"
		role="dialog" aria-hidden="true">
		<div class="modal-content">
			<div class="close-modal" data-dismiss="modal">
				<div class="lr">
					<div class="rl"></div>
				</div>
			</div>
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-lg-offset-2">
						<div class="modal-body">
                            <h2>registration form</h2>
                            <div>
                                <div class="col-lg-12 text-center" id="imgBlock">
                                    <div style="height: 150px; width: 150px; border: solid 1px #f0f0f0">
                                        <img id="imgLoad" src="#" alt="image" style="display: none; height: 150px; width: 150px;" />
                                    </div>
                                    <div style="margin-top: 10px; height: 50px; width: 70px;">
                                        <span class="btn btn-default btn-file">Browse
                                            <input type="file" id="flAvatar">
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group" style="margin:auto; width:500px">
									<input type="text" class="form-control"
										placeholder="Enter your first name *" id="txtFirstName" required
										data-validation-required-message="Please enter your first name.">
									<p class="help-block text-danger"></p>
								</div>
                                <div class="form-group" style="margin:auto; width:500px">
									<input type="text" class="form-control"
										placeholder="Enter your last name *" id="txtLastName" required
										data-validation-required-message="Please enter your last name.">
									<p class="help-block text-danger"></p>
								</div>
                                <div class="form-group" style="margin:auto; width:500px">
									<input type="email" class="form-control"
										placeholder="Enter your Email *" id="txtEmail" required
										data-validation-required-message="Please enter your email addres.">
									<p class="help-block text-danger"></p>
								</div>
                                <div style="margin:auto; width:500px" class="form-group">
									<input type="password" class="form-control"
										placeholder="Enter your Password *" id="txtPassword" required
										data-validation-required-message="Please enter your password.">
									<p class="help-block text-danger"></p>
                                </div>
                                 <div style="margin:auto; width:500px" class="form-group">
									<input type="password" class="form-control"
										placeholder="Enter your password again *" id="txtPasswordAgain" required
										data-validation-required-message="Please enter your password.">
									<p class="help-block text-danger"></p>
                                </div>
                                <div class="col-lg-12 text-right" >
                                    <button type="submit" id="btnSendData" class="btn btn-xl">Registration</button>                                    
                                </div>
                                <script>
                                   

                                </script>
                            </div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<section id="myBooks" class="user" style="height: 980px;">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<h2 class="section-subheading text-muted">Do not forget to
						hand over books.</h2>
					<h3 class="section-heading">You Books</h3>
				</div>
			</div>
			<div class="row">
				<div id="nameUsers"></div>
				<div>
					<img id="photoUsers"/>
				</div>
			</div>
			<div class="col-lg-12">
				<div></div>
				<button type="submit" id="getMyBooks" class="btn btn-xl">You
					Books</button>
			</div>
			<div class="row" style="margin-top: 50px;">
				<div style="height: 50px; width: 150px; float: left;">
					<ul id="booksUser">
						<li></li>
					</ul>
				</div>
				<div style="height: 50px; width: 150px; float: left;">
					<ul id="booksAuthor">
						<li></li>
					</ul>
				</div>
				<div style="height: 50px; width: 150px; float: left;">
					<ul id="publish">
						<li></li>
					</ul>
				</div>
			</div>

		</div>
	</section>

	<!-- SEARCH -->
	<section id="search" class="bg-light-gray" style="height: 980px">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<h2 class="section-heading">Search</h2>
				</div>
			</div>
		</div>
	</section>

	<!-- USERS -->
	<section id="users" class="librarian" style="height: 980px">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<h2 class="section-heading">USERS</h2>
				</div>
			</div>
		</div>
	</section>
	<footer>
		<div class="container">
			<div class="row">
				<div class="col-md-4">
					<span class="copyright">Nikolai Iakovlev &copy; My Library
						2015</span>
				</div>
				<div class="col-md-4">
					<ul class="list-inline social-buttons">
						<li><a href="#"><i class="fa fa-twitter"></i></a></li>
						<li><a href="#"><i class="fa fa-facebook"></i></a></li>
						<li><a href="#"><i class="fa fa-linkedin"></i></a></li>
					</ul>
				</div>
				<div class="col-md-4">
					<ul class="list-inline quicklinks">
						<li><a href="#"></a></li>
						<li><a href="#"></a></li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
	    var user;
	    var imgAvatar;
	    $('#btnSendData').click(function () {
	        debugger
	        var emaiReg = $("#txtEmail").val();
	        var passwordReg = $("#txtPassword").val();
	        var firstNameReg = $("#txtFirstName").val();
	        var lastNameReg = $("#txtLastName").val();
	        var passwordAgain = $("#txtPasswordAgain").val();
	        var imgAvatarReg;
	        var role = "user";

	        if (passwordReg != passwordAgain) {
	            return;
	        }
	        if (imgAvatar == null) {
	            imgAvatarReg = "";
	        }
	        else {
	            imgAvatarReg = imgAvatar;
	        }
	        debugger;
	        $.ajax(
                {
                    type:"post",
                    url: "http://localhost:8080/user/add",
                    data: {"we": 1, "firstName": "as", "lastName": "as", "password": "as", "avatar": "", "email": "as", "role": "user" },
                    dataType: 'json'
                }).always( function (data) {
                        debugger;
                        console.log(data);
                    }
                )
	    //    $.post("http://localhost:8080/user/add",
        //{ "id": 1, "firstName": "as", "lastName": "as", "password": "as", "avatar": "", "email": "as", "role": "user" }
        //,"json").done(function (data) {
        //    debugger;
        //    window.location.href = "#myBooks"
        //})
	    });
	    function readURL(e) {
	        e.preventDefault();
	        if (this.files && this.files[0]) {
	            var reader = new FileReader();
	            $(reader).load(function (e) {
	                $('#imgLoad').attr('src', e.target.result);
	                $('#imgLoad').css("display", "inline");
	            });
	            reader.readAsDataURL(this.files[0]);
	        }
	    }
	    $("#flAvatar").change(readURL);
		$("#getMyBooks").click(
            function getUser(user) {
                var url = "http://localhost:8080/users/user/" + user.id + "/"
                var posting = $.post(url, "json");
                posting.done(function (userBook) {
                    debugger;
                    $("#nameUsers").text(userBook.firstName + "  " + userBook.lastName);
                    $("#photoUsers").atr('href', userBook.photo);
                });
            }
            );

		$(document).ready(function() {

		    if ($.cookie("userInfo") == "NaN")
		        $.cookie("userInfo", "null")

		    
		    if ($.cookie("userInfo") == "null" || $.cookie("userInfo") == null) {

				$('.nav li').hide()
				$('#registr').show();
				$('#login').show();
		    }
		    else if ($.cookie("userInfo") != "null") {

		        $('.nav li').show()
		        $('#registr').hide();
		        $('#login').hide();
		    }
		});

		$("#exit").click(function() {
			$.cookie("userInfo", "null");
			location.reload()
		});

		$("#sendBtn").click(
            function userLogin(e) {
                e.preventDefault();
                console.log('dsdsd');
                debugger;
                var emailUs = $("#email").val();
                var passwordUs = $("#password").val();
                console.log(passwordUs);
                $.post("http://localhost:8080/user/login/",
                                    {
                                        "email": emailUs,
                                        "password": passwordUs
                                    }
                , "json").done(function (data) {
                    debugger;
                    user = data;
                    $.cookie("userInfo", user.email + user.password);
                    $.cookie("id", user.id);
                    if ($.cookie("userInfo") != null) {
                        $('#regist').hide();
                        $('#login').hide();
                        $('#exit').show();
                        $('.nav li').show()
                    }
                    if (user != null) {
                        console.log("");
                        var url = "http://localhost:8080/books/user/" + data.id + "/"
                        var posting = $.post(url, "json");
                        posting
                        .done(function getBooksUser(dataBooks) {
                            var cList = $(' #booksUser');
                            $.each(dataBooks, function view(i) {
                                debugger;
                                var li = $('<li/>').addClass('ui-menu-item').attr('role', 'menuitem')
                                        .appendTo(cList);
                                var aaa = $('<a/>').addClass('ui-all').text(
                                        dataBooks[i].title + "         " + dataBooks[i].author
                                                + "         " + dataBooks[i].publishingHouse).appendTo(
                                        li);

                            });
                        }
                        );
                        debugger;
                        if (user.role == "library") {
                            $(".user").hide();
                        }
                        if (user.role == "user") {
                            $(".librarian").hide();
                        }
                    }
                });
            }
            );
	</script>
	<style>
    .btn-file {
    position: relative;
    overflow: hidden;
}
.btn-file input[type=file] {
    position: absolute;
    top: 0;
    right: 0;
    min-width: 100%;
    min-height: 100%;
    font-size: 100px;
    text-align: right;
    filter: alpha(opacity=0);
    opacity: 0;
    outline: none;
    background: white;
    cursor: inherit;
    display: block;
}

html, body {
	overflow-y: hidden;
}

li {
	list-style-type: none; 
}

#login {
	background-color: #F0F0F0;
}
</style>

</body>

</html>